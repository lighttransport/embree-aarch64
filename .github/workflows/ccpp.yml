name: BuildCI

on: [push, pull_request]

jobs:
  # Disable for a while since build in qemu takes too much time(2~3 hours)
  ## Build Embree on qemu-emulated aarch64 Ubuntu
  #build-native-aarch64:

  #  runs-on: ubuntu-18.04
  #  name: Build on native aarch64

  #  steps:
  #  - uses: actions/checkout@v1
  #  - uses: uraimo/run-on-arch-action@v1.0.5
  #    id: aarch64-build-on-qemu-aarch64
  #    with:
  #      architecture: aarch64
  #      distribution: ubuntu18.04
  #      run: |
  #        apt-get update
  #        apt-get install -y cmake gcc g++
  #        ./scripts/bootstrap-aarch64-linux.sh
  #        cd build-aarch64
  #        make VERBOSE=1

  # Disable until iOS build go success.
  ## Cross-compile Embree for aarch64 target
  #build-cross-aarch64:

  #  runs-on: ubuntu-18.04
  #  name: Build on cross aarch64

  #  steps:
  #    - name: Checkout
  #      uses: actions/checkout@v1
  #    - name: CmakeAndBuild
  #      run: |
  #          sudo apt-get update
  #          sudo apt-get install -y build-essential
  #          sudo apt-get install -y gcc-8-aarch64-linux-gnu g++-8-aarch64-linux-gnu
  #          ./scripts/bootstrap-aarch64-gcc-cross-linux.sh
  #          cd build-aarch64-cross
  #          make VERBOSE=1

  ## Native x86-64 build
  #build-x86-64:

  #  runs-on: ubuntu-18.04
  #  name: Build on x86-64 with clang-7

  #  steps:
  #    - name: Checkout
  #      uses: actions/checkout@v1
  #    - name: CmakeAndBuild
  #      run: |
  #          sudo apt-get update
  #          sudo apt-get install -y build-essential
  #          sudo apt-get install -y clang-7
  #          ./scripts/bootstrap-clang-linux.sh
  #          cd build
  #          make VERBOSE=1

  # iOS build
  build-ios:

    runs-on: macosx-latest
    name: Build for iOS

    steps:
      - name: Checkout
        uses: actions/checkout@v1
      - name: CmakeAndBuild
        run: |
            ./scripts/bootstrap-aarch64-ios.sh
            cd build-aarch64-cross
            make VERBOSE=1
